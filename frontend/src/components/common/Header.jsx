import React, { useEffect } from "react";
import "../../styles/header.css";
import logo from "../../assets/logo-6 1.png";
import { useNavigate } from "react-router-dom";
import { useDispatch, useSelector } from "react-redux";
import { getCart } from "../../actions/cartActions";

export const Header = () => {
  const navigate = useNavigate();
  const dispatch = useDispatch();

  const userToken = localStorage.getItem("userToken");

  const { cart } = useSelector((state) => state.getCart);

  const { products } = useSelector((state) => state.getProducts);

  console.log("headercart",cart)

  const openCart = () => {
    if (userToken) navigate("/cart");
  };

  const goHome = () => {
    navigate("/");
  };

  const login = () => {
    navigate("/login");
  };

  const logout = () => {
    localStorage.removeItem("userToken");
    navigate('/')
  };

  useEffect(() => {
    if(userToken) {
      dispatch(getCart()); 
    }
  },[products])


  return (
    <>
      <div className="main">
        <div className="left-section">
          <div className="phone item">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M18.3952 13.1277C17.1707 13.1277 15.9684 12.9362 14.8291 12.5597C14.2708 12.3693 13.5845 12.544 13.2438 12.8939L10.995 14.5915C8.38701 13.1994 6.78056 11.5934 5.40743 9.00505L7.05509 6.81484C7.48316 6.38734 7.6367 5.76286 7.45274 5.17693C7.07462 4.03161 6.88253 2.8299 6.88253 1.6049C6.88259 0.719948 6.16264 0 5.27775 0H1.60484C0.719946 0 0 0.719948 0 1.60484C0 11.7481 8.25196 20 18.3952 20C19.2801 20 20 19.2801 20 18.3952V14.7325C19.9999 13.8477 19.28 13.1277 18.3952 13.1277Z"
                fill="white"
              />
            </svg>
            <p>+221 33 66 22</p>
          </div>
          <div className="email item">
            <svg
              width="22"
              height="19"
              viewBox="0 0 22 19"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M21.5832 6.4999C21.7508 6.35459 22 6.49053 22 6.72021V16.3062C22 17.5483 21.0762 18.5562 19.9375 18.5562H2.0625C0.923828 18.5562 0 17.5483 0 16.3062V6.7249C0 6.49053 0.244922 6.35928 0.416797 6.50459C1.3793 7.32021 2.65547 8.35615 7.03828 11.8296C7.94492 12.5515 9.47461 14.0702 11 14.0608C12.534 14.0749 14.0937 12.5233 14.966 11.8296C19.3488 8.35615 20.6207 7.31553 21.5832 6.4999ZM11 12.5562C11.9969 12.5749 13.432 11.1874 14.1539 10.6155C19.8559 6.10146 20.2898 5.70771 21.6047 4.58271C21.8539 4.37178 22 4.04365 22 3.69678V2.80615C22 1.56396 21.0762 0.556152 19.9375 0.556152H2.0625C0.923828 0.556152 0 1.56396 0 2.80615V3.69678C0 4.04365 0.146094 4.36709 0.395312 4.58271C1.71016 5.70303 2.14414 6.10146 7.84609 10.6155C8.56797 11.1874 10.0031 12.5749 11 12.5562Z"
                fill="white"
              />
            </svg>
            <p>support@elextra.io</p>
          </div>
        </div>
        <div className="right-section">
          <div className="location item">
            <svg
              width="18"
              height="23"
              viewBox="0 0 18 23"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.07506 22.536C1.26422 13.0737 0 12.1025 0 8.625C0 3.86153 4.02942 0 9 0C13.9706 0 18 3.86153 18 8.625C18 12.1025 16.7358 13.0737 9.92494 22.536C9.47798 23.1547 8.52197 23.1547 8.07506 22.536ZM9 12.2187C11.0711 12.2187 12.75 10.6098 12.75 8.625C12.75 6.64022 11.0711 5.03125 9 5.03125C6.92892 5.03125 5.25 6.64022 5.25 8.625C5.25 10.6098 6.92892 12.2187 9 12.2187Z"
                fill="white"
              />
            </svg>
            <p>Locations</p>
          </div>
          <div className="dollar item">
            <p>$ Dollar (US)</p>
            <svg
              width="15"
              height="8"
              viewBox="0 0 15 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 0.192383H7.09619H14.1924L7.09619 7.28857L0 0.192383Z"
                fill="white"
              />
            </svg>
          </div>
          <div className="language">
            <p>EN</p>
            <svg
              width="15"
              height="8"
              viewBox="0 0 15 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 0.192383H7.09619H14.1924L7.09619 7.28857L0 0.192383Z"
                fill="white"
              />
            </svg>
          </div>
        </div>
      </div>
      <div className="navbar">
        <img src={logo} alt="logo" onClick={goHome} />
        <div className="dropdown">
          <p>Classifieds</p>
          <svg
            width="22"
            height="12"
            viewBox="0 0 22 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M1 2L11 9.5L21 2" stroke="#4D4D4D" stroke-width="3" />
          </svg>
        </div>
        <div className="search-bar">
          <p>Search here...</p>
          <svg
            width="24"
            height="25"
            viewBox="0 0 24 25"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M23.6736 20.7516L18.9998 16.0781C18.7889 15.8672 18.5029 15.75 18.2029 15.75H17.4388C18.7326 14.0953 19.5014 12.0141 19.5014 9.75C19.5014 4.36406 15.137 0 9.75071 0C4.36438 0 0 4.36406 0 9.75C0 15.1359 4.36438 19.5 9.75071 19.5C12.0149 19.5 14.0963 18.7313 15.7512 17.4375V18.2016C15.7512 18.5016 15.8683 18.7875 16.0793 18.9984L20.7531 23.6719C21.1937 24.1125 21.9063 24.1125 22.3423 23.6719L23.6689 22.3453C24.1096 21.9047 24.1096 21.1922 23.6736 20.7516ZM9.75071 15.75C6.43641 15.75 3.75027 13.0688 3.75027 9.75C3.75027 6.43594 6.43172 3.75 9.75071 3.75C13.065 3.75 15.7512 6.43125 15.7512 9.75C15.7512 13.0641 13.0697 15.75 9.75071 15.75Z"
              fill="#3187ED"
            />
          </svg>
        </div>
        <div className="icons">
          <svg
            width="24"
            height="21"
            viewBox="0 0 24 21"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13.6419 2.76934L13.6414 2.76982L12.718 3.72136L12.0003 4.46085L11.2827 3.72136L10.3593 2.76981L10.3581 2.76863C8.32847 0.670218 5.09986 0.389636 2.97897 2.19691L13.6419 2.76934ZM13.6419 2.76934C15.6767 0.669784 18.9008 0.390009 21.0213 2.19653L13.6419 2.76934ZM21.0219 2.19702C23.5197 4.32955 23.6547 8.17042 21.4117 10.4851L21.4115 10.4853L12.3415 19.8506C12.3415 19.8507 12.3414 19.8507 12.3414 19.8508C12.1484 20.0497 11.8476 20.0497 11.6546 19.8508C11.6546 19.8507 11.6545 19.8507 11.6545 19.8506L2.58493 10.4858L21.0219 2.19702ZM2.58451 10.4853C0.345859 8.17052 0.481003 4.3295 2.97883 2.19702L2.58451 10.4853Z"
              stroke="#4D4D4D"
              stroke-width="2"
            />
          </svg>

          <div className="cart-wrapper">
            <svg
              className="cart-icon"
              onClick={openCart}
              width="24"
              height="22"
              viewBox="0 0 24 22"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.75 7.20815H20.0796L16.0712 1.19023C15.9118 0.951182 15.6639 0.78527 15.3821 0.728994C15.1003 0.672717 14.8077 0.730686 14.5687 0.890147C14.3296 1.04961 14.1637 1.2975 14.1074 1.57929C14.0511 1.86108 14.1091 2.15368 14.2686 2.39273L17.4763 7.20815H6.357L9.56799 2.39273C9.72746 2.15368 9.78542 1.86108 9.72915 1.57929C9.67287 1.2975 9.50696 1.04961 9.26791 0.890147C9.02886 0.730686 8.73626 0.672717 8.45447 0.728994C8.17268 0.78527 7.92479 0.951182 7.76533 1.19023L3.75375 7.20815H1.08333C0.796015 7.20815 0.520465 7.32228 0.317301 7.52545C0.114136 7.72861 0 8.00416 0 8.29148C0 8.5788 0.114136 8.85435 0.317301 9.05751C0.520465 9.26068 0.796015 9.37481 1.08333 9.37481H2.16667V18.0415C2.16667 18.9034 2.50908 19.7301 3.11857 20.3396C3.72806 20.9491 4.55471 21.2915 5.41666 21.2915H18.4167C19.2786 21.2915 20.1053 20.9491 20.7148 20.3396C21.3242 19.7301 21.6667 18.9034 21.6667 18.0415V9.37481H22.75C23.0373 9.37481 23.3129 9.26068 23.516 9.05751C23.7192 8.85435 23.8333 8.5788 23.8333 8.29148C23.8333 8.00416 23.7192 7.72861 23.516 7.52545C23.3129 7.32228 23.0373 7.20815 22.75 7.20815V7.20815ZM19.5 18.0415C19.5 18.3288 19.3859 18.6043 19.1827 18.8075C18.9795 19.0107 18.704 19.1248 18.4167 19.1248H5.41666C5.12935 19.1248 4.8538 19.0107 4.65063 18.8075C4.44747 18.6043 4.33333 18.3288 4.33333 18.0415V9.37481H19.5V18.0415Z"
                fill="#4D4D4D"
              />
              <path
                d="M7.58333 17.4998C7.87065 17.4998 8.1462 17.3856 8.34936 17.1825C8.55253 16.9793 8.66666 16.7037 8.66666 16.4164V12.0831C8.66666 11.7958 8.55253 11.5202 8.34936 11.3171C8.1462 11.1139 7.87065 10.9998 7.58333 10.9998C7.29601 10.9998 7.02046 11.1139 6.8173 11.3171C6.61414 11.5202 6.5 11.7958 6.5 12.0831V16.4164C6.5 16.7037 6.61414 16.9793 6.8173 17.1825C7.02046 17.3856 7.29601 17.4998 7.58333 17.4998Z"
                fill="#4D4D4D"
              />
              <path
                d="M11.9166 17.4998C12.2039 17.4998 12.4795 17.3856 12.6826 17.1825C12.8858 16.9793 12.9999 16.7037 12.9999 16.4164V12.0831C12.9999 11.7958 12.8858 11.5202 12.6826 11.3171C12.4795 11.1139 12.2039 10.9998 11.9166 10.9998C11.6293 10.9998 11.3537 11.1139 11.1506 11.3171C10.9474 11.5202 10.8333 11.7958 10.8333 12.0831V16.4164C10.8333 16.7037 10.9474 16.9793 11.1506 17.1825C11.3537 17.3856 11.6293 17.4998 11.9166 17.4998Z"
                fill="#4D4D4D"
              />
              <path
                d="M16.25 17.4998C16.5373 17.4998 16.8128 17.3856 17.016 17.1825C17.2192 16.9793 17.3333 16.7037 17.3333 16.4164V12.0831C17.3333 11.7958 17.2192 11.5202 17.016 11.3171C16.8128 11.1139 16.5373 10.9998 16.25 10.9998C15.9626 10.9998 15.6871 11.1139 15.4839 11.3171C15.2808 11.5202 15.1666 11.7958 15.1666 12.0831V16.4164C15.1666 16.7037 15.2808 16.9793 15.4839 17.1825C15.6871 17.3856 15.9626 17.4998 16.25 17.4998Z"
                fill="#4D4D4D"
              />
            </svg>

            {userToken && <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              {cart?.length ? cart.length : 0 }
              <span class="visually-hidden">unread messages</span>
            </span> }
          </div>
        </div>
        {!userToken ? (
          <button className="logout-btn" onClick={login}>
            Login
          </button>
        ) : (
          <button className="logout-btn" onClick={logout}>
            Logout
          </button>
        )}
      </div>
    </>
  );
};
